<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:BSE.Wpf.Windows.Controls.ImageFlow">

    <Style TargetType="{x:Type controls:ImageFlowPanel}">
        <Style.Resources>
            <ResourceDictionary>
                <ResourceDictionary.MergedDictionaries>
                    <ResourceDictionary Source="/BSE.Wpf.Windows.Controls;component/Resources/ScrollBar.xaml"/>
                </ResourceDictionary.MergedDictionaries>
                <ModelVisual3D x:Key="ModelVisual3D">
                    <ModelVisual3D.Content>
                        <Model3DGroup>
                            <Model3DGroup.Transform>
                                <Transform3DGroup>
                                    <RotateTransform3D CenterX="0" CenterY="0" CenterZ="0">
                                        <RotateTransform3D.Rotation>
                                            <AxisAngleRotation3D Angle="72" Axis="0,1,0"/>
                                        </RotateTransform3D.Rotation>
                                    </RotateTransform3D>
                                    <TranslateTransform3D OffsetX="0.0" OffsetY="0.0" OffsetZ="0.0"/>
                                </Transform3DGroup>
                            </Model3DGroup.Transform>
                            <GeometryModel3D>
                                <GeometryModel3D.Geometry>
                                    <MeshGeometry3D
                            Normals="0,0,1 0,0,1 0,0,1 0,0,1"
                            Positions="-1,-1,0 1,-1,0 1,1,0 -1,1,0"
                            TextureCoordinates="0,1 1,1 1,0 0,0"
                            TriangleIndices="0 1 2 2 3 0" />
                                </GeometryModel3D.Geometry>
                                <GeometryModel3D.Material>
                                    <MaterialGroup>
                                        <DiffuseMaterial>
                                            <DiffuseMaterial.Brush>
                                                <ImageBrush/>
                                            </DiffuseMaterial.Brush>
                                        </DiffuseMaterial>
                                    </MaterialGroup>
                                </GeometryModel3D.Material>
                            </GeometryModel3D>
                            <GeometryModel3D>
                                <GeometryModel3D.Geometry>
                                    <MeshGeometry3D
                            Normals="0,0,1 0,0,1 0,0,1 0,0,1"
                            Positions="-1,-3,0 1,-3,0 1,-1,0 -1,-1,0"
                            TextureCoordinates="0,0 1,0 1,1 0,1"
                            TriangleIndices="0 1 2 2 3 0" />
                                </GeometryModel3D.Geometry>
                                <GeometryModel3D.Material>
                                    <MaterialGroup>
                                        <DiffuseMaterial>
                                            <DiffuseMaterial.Brush>
                                                <ImageBrush/>
                                            </DiffuseMaterial.Brush>
                                        </DiffuseMaterial>
                                    </MaterialGroup>
                                </GeometryModel3D.Material>
                            </GeometryModel3D>
                        </Model3DGroup>
                    </ModelVisual3D.Content>
                </ModelVisual3D>
                <Storyboard x:Key="ModelAnimation">
                    <Rotation3DAnimation Duration="0:0:0.5" DecelerationRatio="0.5" Storyboard.TargetProperty="(Viewport3D.Children)[2].(ModelVisual3D.Children)[0].(ModelVisual3D.Content).(Model3DGroup.Transform).(Transform3DGroup.Children)[1].(RotateTransform3D.Rotation).(AxisAngleRotation3D.Angle)">
                        <Rotation3DAnimation.To>
                            <AxisAngleRotation3D 
                                Axis="0,1,0"
                                Angle="0" />
                        </Rotation3DAnimation.To>
                    </Rotation3DAnimation>
                    <DoubleAnimation Duration="0:0:0.5" To="0" DecelerationRatio="0.5" Storyboard.TargetProperty="(Viewport3D.Children)[2].(ModelVisual3D.Children)[0].(ModelVisual3D.Content).(Model3DGroup.Transform).(Transform3DGroup.Children)[1].(TranslateTransform3D.OffsetX)" />
                    <DoubleAnimation Duration="0:0:0.5" To="0" DecelerationRatio="0.5" Storyboard.TargetProperty="(Viewport3D.Children)[2].(ModelVisual3D.Children)[0].(ModelVisual3D.Content).(Model3DGroup.Transform).(Transform3DGroup.Children)[1].(TranslateTransform3D.OffsetY)"/>
                    <DoubleAnimation Duration="0:0:0.5" To="0" DecelerationRatio="0.5" Storyboard.TargetProperty="(Viewport3D.Children)[2].(ModelVisual3D.Children)[0].(ModelVisual3D.Content).(Model3DGroup.Transform).(Transform3DGroup.Children)[1].(TranslateTransform3D.OffsetZ)"/>
                </Storyboard>
                <Image x:Key="DefaultImage" Source="/BSE.Wpf.Windows.Controls;component/Images/Note.jpg"/>
            </ResourceDictionary>
        </Style.Resources>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type controls:ImageFlowPanel}">
                    <Grid Background="{TemplateBinding Background}" Grid.Column="1" Margin="0">
                        <Viewport3D x:Name="PART_ViewPort" ClipToBounds="True" Panel.ZIndex="0">
                            <Viewport3D.Camera>
                                <PerspectiveCamera Position="0,0,3" FieldOfView="100" />
                            </Viewport3D.Camera>
                            <Viewport3D.Children>
                                <ModelVisual3D>
                                    <ModelVisual3D.Content>
                                        <AmbientLight/>
                                    </ModelVisual3D.Content>
                                </ModelVisual3D>
                                <ModelVisual3D>
                                    <ModelVisual3D.Content>
                                        <DirectionalLight />
                                    </ModelVisual3D.Content>
                                </ModelVisual3D>
                                <ModelVisual3D x:Name="PART_VisualModel"/>
                            </Viewport3D.Children>
                        </Viewport3D>
                        <ScrollBar x:Name="PART_HorizontalScrollBar" VerticalAlignment="Bottom" Margin="5,0,5,5" Panel.ZIndex="1" Orientation="Horizontal" Background="Transparent" Height="20"/>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>
