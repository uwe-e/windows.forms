<UserControl x:Class="BSE.CoverFlow.WPFLib.Widgets.NewAlbums"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:p="clr-namespace:BSE.CoverFlow.WPFLib.Properties"
             mc:Ignorable="d">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding ControlLoadedCommand}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <UserControl.Resources>

        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/BSE.CoverFlow.WPFLib;component/Themes/Black.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style TargetType="{x:Type ListBoxItem}">
                <Setter Property="Padding" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ListBoxItem}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="{x:Type ListBox}">

                <Setter Property="BorderThickness" Value="0"/>
                <!-- Set the ItemTemplate of the ListBox to a DataTemplate 
              which explains how to display an object of type BitmapImage. -->

                <Setter Property="ItemTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <Border Margin="1" x:Name="Bd">
                                <Canvas Height="80" Width="80">
                                    <Image Source="{Binding Path=CoverSource}" Stretch="UniformToFill" Width="80" />
                                    <Rectangle x:Name="CoverForeground" Canvas.Left="0" Canvas.Top="0" Height="80" Width="80"
                                            Fill="Black" Opacity="0" Canvas.ZIndex="1"/>
                                    <TextBlock x:Name="CoverText" Canvas.Left="0" Canvas.Bottom="0" Width="80" Height="50" FontSize="18" Foreground="{StaticResource WhiteColorBrush}" 
                                               FontFamily="Segoe WP" Text="{Binding Title}" FontWeight="SemiBold"
                                               TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Opacity="0"
                                               Canvas.ZIndex="2" />
                                </Canvas>
                            </Border>
                            
                            <DataTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="CoverForeground"
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="0.0" To="0.3" Duration="0:0:0.4"/>
                                                <DoubleAnimation Storyboard.TargetName="CoverText" 
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="0.0" To="1" Duration="0:0:0.4"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="CoverForeground"
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="0.3" To="0" Duration="0:0:0.4"/>
                                                <DoubleAnimation Storyboard.TargetName="CoverText"
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="1" To="0" Duration="0:0:0.4"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
                <!-- Swap out the default items panel with a WrapPanel so that
             the images will be arranged with a different layout. -->
                <Setter Property="ItemsPanel">
                    <Setter.Value>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </Setter.Value>
                </Setter>
                <!-- Set this attached property to 'Disabled' so that the 
             ScrollViewer in the ListBox will never show a horizontal 
             scrollbar, and the WrapPanel it contains will be constrained 
             to the width of the ScrollViewer's viewable surface. -->
                <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid x:Name="Header" Margin="0,0,5,0" Grid.Row="0">
            <TextBlock Text="{x:Static p:Resources.IDS_WidgetNewAlbumsHeader}"  FontFamily="Segoe WP" FontSize="40" FontWeight="Light" Opacity="0.6" Foreground="{StaticResource WhiteColorBrush}"></TextBlock>
        </Grid>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" VerticalAlignment="Top" Command="{Binding SelectionChangedCommand}" CommandParameter="{Binding NewestAlbum}">
                <Button.Style>
                    <Style TargetType="{x:Type Button}">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Canvas Height="160" Width="160">
                                        <Image Source="{Binding NewestAlbum.CoverSource}" Stretch="UniformToFill" Width="160"/>
                                        <Rectangle x:Name="CoverForeground" Canvas.Left="0" Canvas.Top="0" Height="160" Width="160"
                                            Fill="Black" Opacity="0" Canvas.ZIndex="1"/>
                                        <TextBlock x:Name="CoverText" Canvas.Left="0" Canvas.Bottom="0" Width="160" Height="50" FontSize="18" Foreground="{StaticResource WhiteColorBrush}" 
                                               FontFamily="Segoe WP" Text="{Binding NewestAlbum.Title}" FontWeight="SemiBold"
                                               TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Opacity="0"
                                               Canvas.ZIndex="2" />
                                    </Canvas>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetName="CoverForeground"
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="0.0" To="0.3" Duration="0:0:0.4"/>
                                                        <DoubleAnimation Storyboard.TargetName="CoverText" 
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="0.0" To="1" Duration="0:0:0.4"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetName="CoverForeground"
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="0.3" To="0" Duration="0:0:0.4"/>
                                                        <DoubleAnimation Storyboard.TargetName="CoverText"
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="1" To="0" Duration="0:0:0.4"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Button.Style>
            </Button>
            <ListBox x:Name="LstNewAlbums" Grid.Column="1" Background="Transparent" Width="248" ItemsSource="{Binding Path=Albums}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectionChanged">
                        <i:InvokeCommandAction Command="{Binding SelectionChangedCommand}" CommandParameter="{Binding SelectedItem, ElementName=LstNewAlbums}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </ListBox>
        </Grid>
    </Grid>
</UserControl>
